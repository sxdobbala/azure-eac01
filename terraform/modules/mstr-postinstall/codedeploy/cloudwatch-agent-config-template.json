{
    "agent": {
        "region": "{{ ansible_ec2_placement_region }}",
        "metrics_collection_interval": 60,
        "logfile": "/opt/aws/amazon-cloudwatch-agent/logs/amazon-cloudwatch-agent.log",
        "debug": false
    },
    "metrics": {
        "append_dimensions": {
            "InstanceId": "${aws:InstanceId}"
        },
        "metrics_collected": {
            "collectd": {
                "metrics_aggregation_interval": 30
            },
            "cpu": {
                "measurement": [
                    "cpu_usage_idle",
                    "cpu_usage_iowait",
                    "cpu_usage_user",
                    "cpu_usage_system"
                ],
                "metrics_collection_interval": 60,
                "totalcpu": true
            },
            "disk": {
                "resources": [
                    "*"
                ],
                "measurement": [
                    {
                        "name": "free",
                        "rename": "DISK_FREE",
                        "unit": "Gigabytes"
                    },
                    "total",
                    "used",
                    "used_percent"
                ],
                "ignore_file_system_types": [
                    "sysfs",
                    "devtmpfs"
                ],
                "metrics_collection_interval": 60
            },
            "mem": {
                "measurement": [
                    "mem_used_percent",
                    "mem_available",
                    "mem_buffered",
                    "mem_cached",
                    "mem_free",
                    "mem_total"
                ],
                "metrics_collection_interval": 60
            },
            "statsd": {
                "metrics_aggregation_interval": 30,
                "metrics_collection_interval": 60,
                "service_address": ":8125"
            },
            "swap": {
                "measurement": [
                    "swap_used_percent",
                    "swap_free",
                    "swap_used"
                ],
                "metrics_collection_interval": 60
            },
            "procstat": [
                {
                    "pattern": "MSTRSvr",
                    "measurement": [
                        "cpu_usage",
                        "memory_rss"
                    ]
                },
                {
                    "pattern": "MSTRLsn",
                    "measurement": [
                        "cpu_usage",
                        "memory_rss"
                    ]
                },
                {
                    "pattern": "MSTRExec",
                    "measurement": [
                        "cpu_usage",
                        "memory_rss"
                    ]
                },
                {
                    "pattern": "PDFExportService",
                    "measurement": [
                        "cpu_usage",
                        "memory_rss"
                    ]
                }
            ]
        }
    },
    "logs": {
        "force_flush_interval": 5,
        "logs_collected": {
            "files": {
                "collect_list": [
                    {
                        "file_path": "/root/user-data.err",
                        "log_group_name": "/opa/{{ env_prefix }}/{{ elb_path }}/rootlogs/userdatalogs",
                        "log_stream_name": "{local_hostname}_{instance_id}"
                    },
                    {
                        "file_path": "/var/log/messages",
                        "log_group_name": "/opa/{{ env_prefix }}/{{ elb_path }}/syslog/messages",
                        "log_stream_name": "{local_hostname}_{instance_id}"
                    },
                    {
                        "file_path": "/var/log/secure",
                        "log_group_name": "/opa/{{ env_prefix }}/{{ elb_path }}/syslog/secure",
                        "log_stream_name": "{local_hostname}_{instance_id}"
                    },
                    {
                        "file_path": "/opt/mstr/MicroStrategy/log/DSSErrors.log",
                        "log_group_name": "/opa/{{ env_prefix }}/{{ elb_path }}/mstr/DSSErrors.log",
                        "log_stream_name": "{local_hostname}_{instance_id}"
                    },
                    {
                        "file_path": "/opt/apache/tomcat/latest/logs/catalina.out",
                        "log_group_name": "/opa/{{ env_prefix }}/{{ elb_path }}/tomcat/catalina.out",
                        "log_stream_name": "{local_hostname}_{instance_id}"
                    },
                    {
                        "file_path": "/opt/apache/tomcat/latest/logs/manager.*.log",
                        "log_group_name": "/opa/{{ env_prefix }}/{{ elb_path }}/tomcat/manager.log",
                        "log_stream_name": "{local_hostname}_{instance_id}"
                    },
                    {
                        "file_path": "/opt/mstr/mstr.log",
                        "log_group_name": "/opa/{{ env_prefix }}/{{ elb_path }}/mstr/Mstr.log",
                        "log_stream_name": "{local_hostname}_{instance_id}"
                    },
                    {
                        "file_path": "/opt/mstr/em.log",
                        "log_group_name": "/opa/{{ env_prefix }}/{{ elb_path }}/mstr/EnterpriseManager.log",
                        "log_stream_name": "{local_hostname}_{instance_id}"
                    },
                    {
                        "file_path": "/opt/codedeploy-agent/deployment-root/deployment-logs/codedeploy-agent-deployments.log",
                        "log_group_name": "/opa/{{ env_prefix }}/{{ elb_path }}/codedeploy-agent/codedeploy-agent-deployments.log",
                        "log_stream_name": "{local_hostname}_{instance_id}"
                    },
                    {
                        "file_path": "/opt/apache/tomcat/latest/MicroStrategy/WEB-INF/log/**.log",
                        "log_group_name": "/opa/{{ env_prefix }}/{{ elb_path }}/tomcat/MicroStrategy",
                        "log_stream_name": "{local_hostname}_{instance_id}"
                    },
                    {
                        "file_path": "/opt/aws/amazon-cloudwatch-agent/logs/amazon-cloudwatch-agent.log",
                        "log_group_name": "/opa/{{ env_prefix }}/{{ elb_path }}/cloudwatch-agent/amazon-cloudwatch-agent.log",
                        "log_stream_name": "{local_hostname}_{instance_id}"
                    },
                    {
                        "file_path": "/opt/mstr/MicroStrategy/install/CommandManager/CMDMGR.log",
                        "log_group_name": "/opa/{{ env_prefix }}/{{ elb_path }}/mstr/CMDMGR.log",
                        "log_stream_name": "{local_hostname}_{instance_id}"
                    }
                ]
            }
        }
    }
}